@page
@using API.Controllers
@using CAPA_DATOS.Security
@using CAPA_NEGOCIO.UpdateModule.Model
@{
    Layout = "_LayoutUpdates";

    string? identify = HttpContext.Session?.GetString("seassonKey") ?? "";
    if (!SecurityController.HavePermission(identify, Permissions.UPDATE_FAMILY_DATA))
    {
        Response.Redirect("/Security/Login");
        return;
    }
    UserModel user = AuthNetCore.User(identify);
    Parientes_Data_Update? pariente = new Parientes_Data_Update { User_id = user.UserId }.Find<Parientes_Data_Update>();
    string ipAddress = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "IP no disponible";
    pariente!.Entro_al_sistema = true;
    
}
@if (pariente.Actualizo == true)
{
    <h1>Â¡Datos actualizados! Gracias.</h1>
}
else
{
    pariente!.Ip_ingreso = ipAddress;
    pariente.Update();
    <script type="module">
        import { UpdateView } from "/update/UpdateView.js";
        window.onload = () => {
            Main.append(new UpdateView());
        }
    </script>
    <div id="Main" class="app-container"></div>
}
